{
  "name" : "Thesis ETL",
  "jobMode" : "VISUAL",
  "description" : "",
  "role" : "arn:aws:iam::571600865079:role/service-role/AWSGlueServiceRole",
  "executionProperty" : {
    "maxConcurrentRuns" : 1
  },
  "command" : {
    "name" : "glueetl",
    "scriptLocation" : "s3://aws-glue-assets-571600865079-ap-southeast-1/scripts/Thesis ETL.py",
    "pythonVersion" : "3"
  },
  "defaultArguments" : {
    "--enable-metrics" : "true",
    "--enable-spark-ui" : "true",
    "--spark-event-logs-path" : "s3://aws-glue-assets-571600865079-ap-southeast-1/sparkHistoryLogs/",
    "--enable-job-insights" : "true",
    "--enable-observability-metrics" : "true",
    "--enable-glue-datacatalog" : "true",
    "--enable-continuous-cloudwatch-log" : "true",
    "--job-bookmark-option" : "job-bookmark-disable",
    "--job-language" : "python",
    "--TempDir" : "s3://aws-glue-assets-571600865079-ap-southeast-1/temporary/"
  },
  "maxRetries" : 0,
  "allocatedCapacity" : 2,
  "timeout" : 480,
  "maxCapacity" : 2.0,
  "glueVersion" : "5.0",
  "numberOfWorkers" : 2,
  "workerType" : "G.1X",
  "executionClass" : "STANDARD",
  "codeGenConfigurationNodes" : "{\"node-1744298165966\":{\"ApplyMapping\":{\"Inputs\":[\"node-1744298077240\"],\"Mapping\":[{\"Dropped\":true,\"FromPath\":[\"TransactionID\"],\"FromType\":\"string\",\"ToKey\":\"TransactionID\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"CustomerID\"],\"FromType\":\"string\",\"ToKey\":\"CustomerID\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"CustomerDOB\"],\"FromType\":\"timestamp\",\"ToKey\":\"CustomerDOB\",\"ToType\":\"timestamp\"},{\"Dropped\":true,\"FromPath\":[\"CustGender\"],\"FromType\":\"string\",\"ToKey\":\"CustGender\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"CustLocation\"],\"FromType\":\"string\",\"ToKey\":\"CustLocation\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"CustAccountBalance\"],\"FromType\":\"string\",\"ToKey\":\"CustAccountBalance\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"TransactionDate\"],\"FromType\":\"timestamp\",\"ToKey\":\"TransactionDate\",\"ToType\":\"timestamp\"},{\"Dropped\":true,\"FromPath\":[\"TransactionTime\"],\"FromType\":\"string\",\"ToKey\":\"TransactionTime\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"TransactionAmount\"],\"FromType\":\"string\",\"ToKey\":\"TransactionAmount\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"Age\"],\"FromType\":\"long\",\"ToKey\":\"Age\",\"ToType\":\"long\"}],\"Name\":\"Time Dimention\"}},\"node-1744123229330\":{\"CustomCode\":{\"ClassName\":\"CleaningTransform\",\"Code\":\"import pandas as pd\\nfrom awsglue.dynamicframe import DynamicFrame, DynamicFrameCollection\\nfrom pyspark.sql.functions import year\\nfrom pyspark.sql.utils import AnalysisException\\n\\n# Extract first DynamicFrame\\ndyf = dfc.select(list(dfc.keys())[0])\\n\\n# Convert to Spark DataFrame\\ndf_spark = dyf.toDF()\\n\\n# Convert to Pandas (⚠️ only for small datasets)\\ndf_pd = df_spark.toPandas()\\n\\n# ➕ Parse dates using pandas\\ndf_pd['CustomerDOB'] = pd.to_datetime(df_pd['CustomerDOB'], dayfirst=True, errors='coerce')\\ndf_pd['TransactionDate'] = pd.to_datetime(df_pd['TransactionDate'], dayfirst=True, errors='coerce')\\n\\n# Drop rows where dates are missing\\ndf_pd.dropna(subset=['CustomerDOB', 'TransactionDate'], inplace=True)\\n\\n# ⏳ Remove time part (safely)\\ndf_pd['CustomerDOB'] = df_pd['CustomerDOB'].apply(lambda x: x.date() if pd.notnull(x) else x)\\ndf_pd['TransactionDate'] = df_pd['TransactionDate'].apply(lambda x: x.date() if pd.notnull(x) else x)\\n\\n# Convert back to datetime so we can calculate age\\ndf_pd['CustomerDOB'] = pd.to_datetime(df_pd['CustomerDOB'])\\ndf_pd['TransactionDate'] = pd.to_datetime(df_pd['TransactionDate'])\\n\\n# Fix DOBs with 2000+ error\\ndf_pd['CustomerDOB'] = df_pd.apply(\\n    lambda row: row['CustomerDOB'] - pd.DateOffset(years=100) if row['CustomerDOB'] > row['TransactionDate'] else row['CustomerDOB'],\\n    axis=1\\n)\\n\\n# Calculate age\\ndf_pd['Age'] = df_pd['TransactionDate'].dt.year - df_pd['CustomerDOB'].dt.year\\n\\n# Filter age between 18 and 100\\ndf_pd = df_pd[(df_pd['Age'] >= 18) & (df_pd['Age'] <= 100)]\\n\\n# Drop duplicates and nulls\\ndf_pd.drop_duplicates(inplace=True)\\ndf_pd.dropna(inplace=True)\\n\\n# Convert back to Spark DataFrame\\nif df_pd.empty:\\n    df_result = glueContext.spark_session.createDataFrame([], df_spark.schema)\\nelse:\\n    df_result = glueContext.spark_session.createDataFrame(df_pd)\\n\\n# Convert the date columns to Spark timestamp columns \\nfrom pyspark.sql.functions import col\\ndf_result = df_result.withColumn(\\\"CustomerDOB\\\", col(\\\"CustomerDOB\\\").cast(\\\"timestamp\\\"))\\ndf_result = df_result.withColumn(\\\"TransactionDate\\\", col(\\\"TransactionDate\\\").cast(\\\"timestamp\\\"))\\n\\n# Rename the column \\\"TransactionAmount (INR)\\\" to \\\"TransactionAmount\\\"\\ndf_result = df_result.withColumnRenamed(\\\"TransactionAmount (INR)\\\", \\\"TransactionAmount\\\")\\n\\n# Convert to DynamicFrame\\ndyf_cleaned = DynamicFrame.fromDF(df_result, glueContext, \\\"dyf_cleaned\\\")\\n\\nreturn DynamicFrameCollection({\\\"cleaned_data\\\": dyf_cleaned}, glueContext)\\n\\n\",\"Inputs\":[\"node-1744123198576\"],\"Name\":\"Cleaning Transform\",\"OutputSchemas\":[{\"Columns\":[{\"Name\":\"TransactionID\",\"Type\":\"string\"},{\"Name\":\"CustomerID\",\"Type\":\"string\"},{\"Name\":\"CustomerDOB\",\"Type\":\"timestamp\"},{\"Name\":\"CustGender\",\"Type\":\"string\"},{\"Name\":\"CustLocation\",\"Type\":\"string\"},{\"Name\":\"CustAccountBalance\",\"Type\":\"string\"},{\"Name\":\"TransactionDate\",\"Type\":\"timestamp\"},{\"Name\":\"TransactionTime\",\"Type\":\"string\"},{\"Name\":\"TransactionAmount\",\"Type\":\"string\"},{\"Name\":\"Age\",\"Type\":\"bigint\"}]}]}},\"node-1744728926991\":{\"S3DirectTarget\":{\"AutoDataQuality\":{\"EvaluationContext\":\"EvaluateDataQuality_node1744728782681\",\"IsEnabled\":false},\"Compression\":\"snappy\",\"Format\":\"csv\",\"Inputs\":[\"node-1744728912898\"],\"Name\":\"Time Dimension Table\",\"PartitionKeys\":[],\"Path\":\"s3://aws-bucket-target-database-csv\",\"SchemaChangePolicy\":{\"Database\":\"supabase-tnno\",\"EnableUpdateCatalog\":false,\"Table\":\"time-dimention\",\"UpdateBehavior\":\"UPDATE_IN_DATABASE\"}}},\"node-1744123198576\":{\"S3CsvSource\":{\"AdditionalOptions\":{\"EnableSamplePath\":false,\"SamplePath\":\"s3://aws-bucket-source-database-csv/bank_transactions.csv\"},\"Escaper\":\"\",\"Exclusions\":[],\"Name\":\"Amazon S3\",\"OptimizePerformance\":false,\"OutputSchemas\":[{\"Columns\":[{\"Name\":\"transactionid\",\"Type\":\"string\"},{\"Name\":\"customerid\",\"Type\":\"string\"},{\"Name\":\"customerdob\",\"Type\":\"string\"},{\"Name\":\"custgender\",\"Type\":\"string\"},{\"Name\":\"custlocation\",\"Type\":\"string\"},{\"Name\":\"custaccountbalance\",\"Type\":\"string\"},{\"Name\":\"transactiondate\",\"Type\":\"string\"},{\"Name\":\"transactiontime\",\"Type\":\"string\"},{\"Name\":\"transactionamount (inr)\",\"Type\":\"string\"}]}],\"Paths\":[\"s3://aws-bucket-source-database-csv/bank_transactions.csv\"],\"QuoteChar\":\"quote\",\"Recurse\":true,\"Separator\":\"comma\",\"WithHeader\":true}},\"node-1744728886421\":{\"CustomCode\":{\"ClassName\":\"MyTransform\",\"Code\":\"import pandas as pd\\nfrom awsglue.dynamicframe import DynamicFrame, DynamicFrameCollection\\n\\n# Extract the first dynamic frame from the collection\\ndyf = dfc.select(list(dfc.keys())[0])\\n\\n# Convert to Spark DataFrame and then to Pandas DataFrame\\ndf_spark = dyf.toDF()\\ndf_pd = df_spark.toPandas()\\n\\n# Create a time dimension from unique TransactionDate values\\n# (Assumes the input dataframe has a column named 'TransactionDate')\\nunique_dates = pd.DataFrame({'Date': df_pd['TransactionDate'].unique()})\\nunique_dates['Date'] = pd.to_datetime(unique_dates['Date'])\\n\\n# Add time attributes\\nunique_dates['Year'] = unique_dates['Date'].dt.year\\nunique_dates['Month'] = unique_dates['Date'].dt.month\\nunique_dates['MonthName'] = unique_dates['Date'].dt.strftime('%B')\\nunique_dates['Quarter'] = unique_dates['Date'].dt.quarter\\n\\n# Create DateID in format YYYYMMDD as integer\\nunique_dates['DateID'] = unique_dates['Date'].dt.strftime('%Y%m%d').astype(int)\\n\\n# Convert the Pandas DataFrame back to a Spark DataFrame\\ndf_result = glueContext.spark_session.createDataFrame(unique_dates)\\n\\n# Convert to DynamicFrame\\ndyf_time = DynamicFrame.fromDF(df_result, glueContext, \\\"dyf_time\\\")\\n\\n# Return the dynamic frame as part of a collection with key \\\"time_dimension\\\"\\nreturn DynamicFrameCollection({\\\"time_dimension\\\": dyf_time}, glueContext)\",\"Inputs\":[\"node-1744298165966\"],\"Name\":\"Time dimension transform\",\"OutputSchemas\":[{\"Columns\":[{\"Name\":\"Date\",\"Type\":\"timestamp\"},{\"Name\":\"Year\",\"Type\":\"bigint\"},{\"Name\":\"Month\",\"Type\":\"bigint\"},{\"Name\":\"MonthName\",\"Type\":\"string\"},{\"Name\":\"Quarter\",\"Type\":\"bigint\"},{\"Name\":\"DateID\",\"Type\":\"bigint\"}]}]}},\"node-1744729013876\":{\"S3DirectTarget\":{\"AutoDataQuality\":{\"EvaluationContext\":\"EvaluateDataQuality_node1744728782681\",\"IsEnabled\":false},\"Compression\":\"snappy\",\"Format\":\"csv\",\"Inputs\":[\"node-1744298164185\"],\"Name\":\"Transaction Dimension table\",\"PartitionKeys\":[],\"Path\":\"s3://aws-bucket-target-database-csv\",\"SchemaChangePolicy\":{\"Database\":\"supabase-tnno\",\"EnableUpdateCatalog\":false,\"Table\":\"transaction-dimention\",\"UpdateBehavior\":\"UPDATE_IN_DATABASE\"}}},\"node-1744737582349\":{\"MySQLCatalogTarget\":{\"Database\":\"supabase-tnno\",\"Inputs\":[\"node-1744298164185\"],\"Name\":\"MySQL\",\"Table\":\"transaction-dimention\"}},\"node-1744729123837\":{\"S3DirectTarget\":{\"AutoDataQuality\":{\"EvaluationContext\":\"EvaluateDataQuality_node1744728782681\",\"IsEnabled\":false},\"Compression\":\"snappy\",\"Format\":\"csv\",\"Inputs\":[\"node-1744298001651\"],\"Name\":\"Customer Dimension table\",\"PartitionKeys\":[],\"Path\":\"s3://aws-bucket-target-database-csv\",\"SchemaChangePolicy\":{\"Database\":\"supabase-tnno\",\"EnableUpdateCatalog\":false,\"Table\":\"customer-detail-dimention\",\"UpdateBehavior\":\"UPDATE_IN_DATABASE\"}}},\"node-1744737700955\":{\"MySQLCatalogTarget\":{\"Database\":\"supabase-tnno\",\"Inputs\":[\"node-1744298001651\"],\"Name\":\"MySQL\",\"Table\":\"customer-detail-dimention\"}},\"node-1744737663379\":{\"MySQLCatalogTarget\":{\"Database\":\"supabase-tnno\",\"Inputs\":[\"node-1744728912898\"],\"Name\":\"MySQL\",\"Table\":\"time-dimention\"}},\"node-1744298164185\":{\"ApplyMapping\":{\"Inputs\":[\"node-1744298077240\"],\"Mapping\":[{\"Dropped\":false,\"FromPath\":[\"TransactionID\"],\"FromType\":\"string\",\"ToKey\":\"TransactionID\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"CustomerID\"],\"FromType\":\"string\",\"ToKey\":\"CustomerID\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"CustomerDOB\"],\"FromType\":\"timestamp\",\"ToKey\":\"CustomerDOB\",\"ToType\":\"timestamp\"},{\"Dropped\":true,\"FromPath\":[\"CustGender\"],\"FromType\":\"string\",\"ToKey\":\"CustGender\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"CustLocation\"],\"FromType\":\"string\",\"ToKey\":\"CustLocation\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"CustAccountBalance\"],\"FromType\":\"string\",\"ToKey\":\"CustAccountBalance\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"TransactionDate\"],\"FromType\":\"timestamp\",\"ToKey\":\"TransactionDate\",\"ToType\":\"timestamp\"},{\"Dropped\":false,\"FromPath\":[\"TransactionTime\"],\"FromType\":\"string\",\"ToKey\":\"TransactionTime\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"TransactionAmount\"],\"FromType\":\"string\",\"ToKey\":\"TransactionAmount\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"Age\"],\"FromType\":\"long\",\"ToKey\":\"Age\",\"ToType\":\"long\"}],\"Name\":\"Transaction Dimention\"}},\"node-1744298077240\":{\"SelectFromCollection\":{\"Index\":0,\"Inputs\":[\"node-1744123229330\"],\"Name\":\"Select From Collection\"}},\"node-1744298001651\":{\"ApplyMapping\":{\"Inputs\":[\"node-1744298077240\"],\"Mapping\":[{\"Dropped\":true,\"FromPath\":[\"TransactionID\"],\"FromType\":\"string\",\"ToKey\":\"TransactionID\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"CustomerID\"],\"FromType\":\"string\",\"ToKey\":\"CustomerID\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"CustomerDOB\"],\"FromType\":\"timestamp\",\"ToKey\":\"CustomerDOB\",\"ToType\":\"timestamp\"},{\"Dropped\":false,\"FromPath\":[\"CustGender\"],\"FromType\":\"string\",\"ToKey\":\"CustGender\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"CustLocation\"],\"FromType\":\"string\",\"ToKey\":\"CustLocation\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"CustAccountBalance\"],\"FromType\":\"string\",\"ToKey\":\"CustAccountBalance\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"TransactionDate\"],\"FromType\":\"timestamp\",\"ToKey\":\"TransactionDate\",\"ToType\":\"timestamp\"},{\"Dropped\":true,\"FromPath\":[\"TransactionTime\"],\"FromType\":\"string\",\"ToKey\":\"TransactionTime\",\"ToType\":\"string\"},{\"Dropped\":true,\"FromPath\":[\"TransactionAmount\"],\"FromType\":\"string\",\"ToKey\":\"TransactionAmount\",\"ToType\":\"string\"},{\"Dropped\":false,\"FromPath\":[\"Age\"],\"FromType\":\"long\",\"ToKey\":\"Age\",\"ToType\":\"long\"}],\"Name\":\"Customer Dimention\"}},\"node-1744728912898\":{\"SelectFromCollection\":{\"Index\":0,\"Inputs\":[\"node-1744728886421\"],\"Name\":\"Select Time dimension\"}}}",
  "sourceControlDetails" : {
    "provider" : "GITHUB",
    "repository" : "final-thesis-ETL",
    "branch" : "main",
    "folder" : "glue-scripts"
  }
}